<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Booking Cart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <link rel="stylesheet" href="RazorPay.css">

</head>

<body>
    <section class="container py-5">
        <div class="row justify-content-center">
            <div class="col-12">
                <div class="card">
                    <div class="card-body p-0">
                        <div class="row g-0">
                            <div class="col-lg-8 p-5">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h1 class="fw-bold mb-0">Adventure Awaits</h1>
                                    <h6 class="mb-0 text-muted"><span id="total-items">3</span> items</h6>
                                </div>
                                <hr class="my-4">

                                <div class="cart-items">
                                    <!-- Goa Package -->
                                    <div class="row mb-4 align-items-center cart-item" data-package-id="1"
                                        data-base-price="4400">
                                        <div class="col-md-2">
                                            <img src="https://images.unsplash.com/photo-1512343879784-a960bf40e7f2"
                                                class="item-img" alt="Goa">
                                        </div>
                                        <div class="col-md-4">
                                            <h6 class="fw-bold">Goa Beach Package</h6>
                                            <small>3 Days, 2 Nights</small>
                                            <div class="form-check insurance-option">
                                                <input class="form-check-input insurance-checkbox" type="checkbox"
                                                    id="insurance-1">
                                                <label class="form-check-label" for="insurance-1">Add Insurance
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="d-flex align-items-center">
                                                <span class="me-2">Travelers:</span>
                                                <div class="quantity-control">
                                                    <button
                                                        class="btn btn-sm btn-outline-secondary minus-btn">-</button>
                                                    <input type="number"
                                                        class="form-control form-control-sm quantity-input" value="1"
                                                        min="1" max="10">
                                                    <button class="btn btn-sm btn-outline-secondary plus-btn">+</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2 text-end">
                                            <h6 class="fw-bold">₹<span class="item-price">44.00</span></h6>
                                            <button class="btn btn-sm btn-danger remove-item"><i
                                                    class="bi bi-trash"></i></button>
                                        </div>
                                    </div>

                                    <!-- Elora Caves -->
                                    <div class="row mb-4 align-items-center cart-item" data-package-id="2"
                                        data-base-price="3500">
                                        <div class="col-md-2">
                                            <img src="https://plus.unsplash.com/premium_photo-1697729588019-20a1f5a325d1?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                                                class="item-img" alt="Elora">
                                        </div>
                                        <div class="col-md-4">
                                            <h6 class="fw-bold">Elora Caves Tour</h6>
                                            <small>Full Day Trip</small>
                                            <div class="form-check insurance-option">
                                                <input class="form-check-input insurance-checkbox" type="checkbox"
                                                    id="insurance-2">
                                                <label class="form-check-label" for="insurance-2">Add Insurance
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="d-flex align-items-center">
                                                <span class="me-2">Travelers:</span>
                                                <div class="quantity-control">
                                                    <button
                                                        class="btn btn-sm btn-outline-secondary minus-btn">-</button>
                                                    <input type="number"
                                                        class="form-control form-control-sm quantity-input" value="1"
                                                        min="1" max="10">
                                                    <button class="btn btn-sm btn-outline-secondary plus-btn">+</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2 text-end">
                                            <h6 class="fw-bold">₹<span class="item-price">35.00</span></h6>
                                            <button class="btn btn-sm btn-danger remove-item"><i
                                                    class="bi bi-trash"></i></button>
                                        </div>
                                    </div>

                                    <!-- Ooty Package -->
                                    <div class="row mb-4 align-items-center cart-item" data-package-id="3"
                                        data-base-price="5200">
                                        <div class="col-md-2">
                                            <img src="https://images.unsplash.com/photo-1527631746610-bca00a040d60"
                                                class="item-img" alt="Ooty">
                                        </div>
                                        <div class="col-md-4">
                                            <h6 class="fw-bold">Ooty Hill Station</h6>
                                            <small>2 Days, 1 Night</small>
                                            <div class="form-check insurance-option">
                                                <input class="form-check-input insurance-checkbox" type="checkbox"
                                                    id="insurance-3">
                                                <label class="form-check-label" for="insurance-3">Add Insurance
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="d-flex align-items-center">
                                                <span class="me-2">Travelers:</span>
                                                <div class="quantity-control">
                                                    <button
                                                        class="btn btn-sm btn-outline-secondary minus-btn">-</button>
                                                    <input type="number"
                                                        class="form-control form-control-sm quantity-input" value="1"
                                                        min="1" max="10">
                                                    <button class="btn btn-sm btn-outline-secondary plus-btn">+</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2 text-end">
                                            <h6 class="fw-bold">₹<span class="item-price">52.00</span></h6>
                                            <button class="btn btn-sm btn-danger remove-item"><i
                                                    class="bi bi-trash"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4 bg-light p-5">
                                <h3 class="fw-bold mb-4">Order Summary</h3>
                                <hr class="my-3">

                                <div class="d-flex justify-content-between mb-2">
                                    <span>Items (<span id="summary-items-count">3</span>)</span>
                                    <span id="subtotal">₹131.00</span>
                                </div>

                                <div class="d-flex justify-content-between mb-2">
                                    <span>Insurance</span>
                                    <span id="insurance-total">₹0.00</span>
                                </div>

                                <div class="d-flex justify-content-between mb-2">
                                    <span>Taxes (10%)</span>
                                    <span id="taxes">₹13.10</span>
                                </div>

                                <hr class="my-3">

                                <div class="d-flex justify-content-between mb-4">
                                    <h5 class="fw-bold">Total</h5>
                                    <h5 id="total-price">₹144.10</h5>
                                </div>

                                <button class="btn btn-dark w-100 py-3" id="checkout-button">
                                    <i class="bi bi-lock-fill me-2"></i>Proceed to Payment
                                </button>

                                <div id="processing-payment" class="mt-3">
                                    <div class="spinner-border text-primary" role="status"></div>
                                    <p class="mt-2">Processing payment...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Error Modal -->
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <h3 class="text-danger">Payment Failed</h3>
            <p id="errorMessage">Oops! Something went wrong.</p>
            <button class="btn btn-danger" id="closeErrorModal">OK</button>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <h3 class="text-success">Payment Successful!</h3>
            <p id="successMessage">Your booking is confirmed.</p>
            <button class="btn btn-success" id="closeSuccessModal">Continue</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const INSURANCE_COST_PER_PERSON = 500; // ₹5.00 per person
            const TAX_RATE = 0.10; // 10% tax

            // Initialize
            updatePrices();

            // Event Delegation
            document.querySelector('.cart-items').addEventListener('click', function (e) {
                if (e.target.classList.contains('plus-btn')) {
                    const quantityControl = e.target.closest('.quantity-control');
                    if (quantityControl) {
                        const input = quantityControl.querySelector('.quantity-input');
                        if (input && parseInt(input.value) < 10) {
                            input.value = parseInt(input.value) + 1;
                            updatePrices();
                        }
                    }
                } else if (e.target.classList.contains('minus-btn')) {
                    const quantityControl = e.target.closest('.quantity-control');
                    if (quantityControl) {
                        const input = quantityControl.querySelector('.quantity-input');
                        if (input && parseInt(input.value) > 1) {
                            input.value = parseInt(input.value) - 1;
                            updatePrices();
                        }
                    }
                } else if (e.target.classList.contains('remove-item') || e.target.closest(
                        '.remove-item')) {
                    e.target.closest('.cart-item').remove();
                    updatePrices();
                }
            });

            // Listen for insurance checkbox changes
            document.querySelectorAll('.insurance-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function () {
                    updatePrices();
                });
            });

            function updatePrices() {
                let subtotal = 0;
                let itemCount = 0;
                let insuranceTotal = 0;

                document.querySelectorAll('.cart-item').forEach(item => {
                    const quantity = parseInt(item.querySelector('.quantity-input').value);
                    const basePrice = parseInt(item.getAttribute('data-base-price'));
                    const insuranceChecked = item.querySelector('.insurance-checkbox').checked;

                    // Calculate item total
                    const itemTotal = quantity * basePrice;
                    subtotal += itemTotal;
                    itemCount += quantity;

                    // Update item price display
                    item.querySelector('.item-price').textContent = (itemTotal / 100).toFixed(2);

                    // Calculate insurance if selected
                    if (insuranceChecked) {
                        insuranceTotal += quantity * INSURANCE_COST_PER_PERSON;
                    }
                });

                const taxes = Math.round(subtotal * TAX_RATE);
                const total = subtotal + taxes + insuranceTotal;

                // Update display
                document.getElementById('subtotal').textContent = '₹' + (subtotal / 100).toFixed(2);
                document.getElementById('insurance-total').textContent = '₹' + (insuranceTotal / 100).toFixed(
                    2);
                document.getElementById('taxes').textContent = '₹' + (taxes / 100).toFixed(2);
                document.getElementById('total-price').textContent = '₹' + (total / 100).toFixed(2);
                document.getElementById('total-items').textContent = itemCount;
                document.getElementById('summary-items-count').textContent = itemCount;

                return total;
            }

            // Razorpay Payment Integration
            document.getElementById('checkout-button').addEventListener('click', function () {
                const totalAmount = updatePrices();
                if (totalAmount <= 0) {
                    showErrorModal('Please add items to your cart before proceeding to payment.');
                    return;
                }

                this.disabled = true;
                document.getElementById('processing-payment').style.display = 'block';

                // Razorpay options
                const options = {
                    "key": "rzp_test_XrIUc52C7IOx6I",
                    "amount": totalAmount,
                    "currency": "INR",
                    "name": "Adventure Awaits Travel",
                    "description": "Tour Package Booking",
                    "image": "https://example.com/logo.png",
                    "handler": function (response) {
                        document.getElementById('processing-payment').style.display = 'none';
                        showSuccessModal(`Payment ID: ${response.razorpay_payment_id}`);
                    },
                    "prefill": {
                        "name": "John Doe",
                        "email": "john.doe@example.com",
                        "contact": "9876543210"
                    },
                    "theme": {
                        "color": "#3399cc"
                    }
                };

                const rzp = new Razorpay(options);
                rzp.open();

                rzp.on('payment.failed', function (response) {
                    document.getElementById('processing-payment').style.display = 'none';
                    document.getElementById('checkout-button').disabled = false;
                    showErrorModal(response.error.description ||
                        'Payment failed. Please try again.');
                });
            });

            // Modal functions
            function showErrorModal(message) {
                document.getElementById('errorMessage').textContent = message;
                document.getElementById('errorModal').style.display = 'flex';
            }

            function showSuccessModal(message) {
                document.getElementById('successMessage').textContent = message;
                document.getElementById('successModal').style.display = 'flex';
            }

            document.getElementById('closeErrorModal').addEventListener('click', function () {
                document.getElementById('errorModal').style.display = 'none';
            });

            document.getElementById('closeSuccessModal').addEventListener('click', function () {
                document.getElementById('successModal').style.display = 'none';
                // Redirect to home or booking confirmation page
                // window.location.href = 'booking-confirmation.html';
            });
        });
    </script>
</body>

</html>
